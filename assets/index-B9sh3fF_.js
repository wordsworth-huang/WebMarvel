(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function l(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=l(n);fetch(n.href,s)}})();var d=(t=>(t.YELLOW="yellow",t.BLUE="blue",t.ORANGE="orange",t.RED="red",t.PURPLE="purple",t.GRAY="gray",t))(d||{});class P{tokens;constructor(e){this.tokens={yellow:0,blue:0,orange:0,red:0,purple:0,gray:0,...e}}equals(e){return this.tokens.yellow===e.tokens.yellow&&this.tokens.blue===e.tokens.blue&&this.tokens.orange===e.tokens.orange&&this.tokens.red===e.tokens.red&&this.tokens.purple===e.tokens.purple&&this.tokens.gray===e.tokens.gray}}var r=(t=>(t.YELLOW="yellow",t.BLUE="blue",t.ORANGE="orange",t.RED="red",t.PURPLE="purple",t))(r||{}),i=(t=>(t.BLUE="blue",t.ORANGE="orange",t.GREEN="green",t))(i||{});const Oe={yellow:d.YELLOW,blue:d.BLUE,orange:d.ORANGE,red:d.RED,purple:d.PURPLE},se=[{name:"Hulk",numOfA:2,price:{yellow:0,blue:3,orange:5,red:3,purple:3},score:3,color:r.PURPLE,levelColor:i.BLUE,isSelected:!1},{name:"Spider Man",numOfA:0,price:{yellow:7,blue:0,orange:0,red:3,purple:0},score:5,color:r.ORANGE,levelColor:i.BLUE,isSelected:!1},{name:"Green Goblin",numOfA:0,price:{yellow:0,blue:7,orange:0,red:0,purple:3},score:5,color:r.YELLOW,levelColor:i.BLUE,isSelected:!1},{name:"Doctor Octopus",numOfA:0,price:{yellow:0,blue:7,orange:0,red:0,purple:0},score:4,color:r.YELLOW,levelColor:i.BLUE,isSelected:!1},{name:"Vision",numOfA:1,price:{yellow:3,blue:6,orange:0,red:3,purple:0},score:4,color:r.YELLOW,levelColor:i.BLUE,isSelected:!1},{name:"Doctor Strange",numOfA:1,price:{yellow:0,blue:0,orange:0,red:0,purple:7},score:4,color:r.RED,levelColor:i.BLUE,isSelected:!1},{name:"Captain Marvel",numOfA:1,price:{yellow:0,blue:3,orange:6,red:0,purple:3},score:4,color:r.PURPLE,levelColor:i.BLUE,isSelected:!1},{name:"Iron Fist",numOfA:0,price:{yellow:0,blue:0,orange:0,red:7,purple:0},score:4,color:r.RED,levelColor:i.BLUE,isSelected:!1},{name:"Thor",numOfA:2,price:{yellow:3,blue:3,orange:0,red:3,purple:5},score:3,color:r.RED,levelColor:i.BLUE,isSelected:!1},{name:"Loki",numOfA:0,price:{yellow:0,blue:3,orange:0,red:0,purple:7},score:5,color:r.RED,levelColor:i.BLUE,isSelected:!1},{name:"Gamora",numOfA:0,price:{yellow:0,blue:0,orange:3,red:7,purple:0},score:5,color:r.BLUE,levelColor:i.BLUE,isSelected:!1},{name:"Ant Man",numOfA:1,price:{yellow:3,blue:0,orange:3,red:6,purple:0},score:4,color:r.BLUE,levelColor:i.BLUE,isSelected:!1},{name:"Drax",numOfA:0,price:{yellow:0,blue:0,orange:7,red:0,purple:0},score:4,color:r.PURPLE,levelColor:i.BLUE,isSelected:!1},{name:"Luke Cage",numOfA:0,price:{yellow:3,blue:0,orange:7,red:0,purple:0},score:5,color:r.PURPLE,levelColor:i.BLUE,isSelected:!1},{name:"Captain America",numOfA:2,price:{yellow:5,blue:3,orange:3,red:0,purple:3},score:3,color:r.ORANGE,levelColor:i.BLUE,isSelected:!1},{name:"Black Widow",numOfA:2,price:{yellow:3,blue:3,orange:0,red:5,purple:3},score:3,color:r.BLUE,levelColor:i.BLUE,isSelected:!1},{name:"Nova",numOfA:0,price:{yellow:0,blue:0,orange:3,red:3,purple:6},score:4,color:r.RED,levelColor:i.BLUE,isSelected:!1},{name:"Black Bolt",numOfA:0,price:{yellow:7,blue:0,orange:0,red:0,purple:0},score:4,color:r.ORANGE,levelColor:i.BLUE,isSelected:!1},{name:"Iron Man",numOfA:2,price:{yellow:3,blue:5,orange:3,red:3,purple:0},score:3,color:r.YELLOW,levelColor:i.BLUE,isSelected:!1},{name:"Black Panther",numOfA:1,price:{yellow:6,blue:0,orange:3,red:0,purple:3},score:4,color:r.ORANGE,levelColor:i.BLUE,isSelected:!1}];class J{card;color;cardLeft;x;y;width;height;constructor(e,l,o,n,s,c,h){this.card=e,this.color=l,this.cardLeft=o,this.x=n,this.y=s,this.width=c,this.height=h}draw(e){this.card!==null&&(e.fillStyle=this.color,e.fillRect(this.x,this.y,this.width,this.height),e.lineWidth=this.card.isSelected?5:1,e.strokeStyle=this.card.isSelected?"red":"black",e.strokeRect(this.x,this.y,this.width,this.height),e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(`${this.cardLeft}`,this.x+this.width/2,this.y+this.height/2)),e.lineWidth=1}contains(e,l){return e>=this.x&&e<=this.x+this.width&&l>=this.y&&l<=this.y+this.height}}const I="rgba(0, 0, 0, 0)",ee={[r.YELLOW]:"#ffff00",[r.BLUE]:"#3b82f6",[r.ORANGE]:"#fb923c",[r.RED]:"#ef4444",[r.PURPLE]:"#a855f7"},Re={[d.YELLOW]:"#ffff00",[d.BLUE]:"#3b82f6",[d.ORANGE]:"#fb923c",[d.RED]:"#ef4444",[d.PURPLE]:"#a855f7",[d.GRAY]:"#666666"};class ${value;color;r;x;y;constructor(e,l,o,n,s){this.value=e,this.color=l,this.x=o,this.y=n,this.r=s}draw(e){const l=this.value===0;e.beginPath(),e.arc(this.x+this.r,this.y+this.r,this.r,0,Math.PI*2),e.fillStyle=l?I:Re[this.color],e.fill(),e.strokeStyle=l?I:"black",e.stroke(),l||(e.fillStyle="black",e.font=`${this.r*2-4}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(String(this.value),this.x+this.r,this.y+this.r+this.r*2*.05))}contains(e,l){return e>=this.x&&e<=this.x+this.r*2&&l>=this.y&&l<=this.y+this.r*2}}class ie{card;color;width;height;x;y;constructor(e,l,o,n,s,c){this.card=e,this.color=l,this.x=o,this.y=n,this.width=s,this.height=c}draw(e){if(this.card!==null){e.fillStyle="#fff",e.fillRect(this.x,this.y,this.width,this.height);const l=this.height/5;e.fillStyle=ee[this.card.color],e.fillRect(this.x+2,this.y+2,this.width-4,l),e.fillStyle="black";let o=l*.9;e.font=`${o}px Arial`,e.textAlign="center",e.textBaseline="middle";const n=this.card.score,s=this.card.score===0?"":String(n),c=this.card.numOfA===0?"":this.card.numOfA===1?"â’¶":"â’¶â’¶";e.fillText(`${s}${c}`,this.x+2+this.width/2,this.y+2+l/2+l*.05),e.lineWidth=this.card.isSelected?5:1,e.strokeStyle=this.card.isSelected?"red":"black",e.strokeRect(this.x,this.y,this.width,this.height),e.fillStyle="black",o=this.width/5,e.font=`${o}px Arial`,e.textAlign="center",e.textBaseline="middle",this.fillTextRotate90(e,this.card.name,this.x+this.width-o/2-this.width/5,this.y+this.height/2+l/2),e.lineWidth=1,Object.entries(this.card.price).filter(([a,u])=>u>0).reverse().forEach(([a,u],p)=>{new $(u,Oe[a],this.x+this.width/10,this.y+(4-p)*l*.9+this.width/5,l/2*.8).draw(e)})}}fillTextRotate90(e,l,o,n){e.save(),e.translate(o,n),e.rotate(Math.PI/2),e.fillText(l,0,0),e.restore()}contains(e,l){return e>=this.x&&e<=this.x+this.width&&l>=this.y&&l<=this.y+this.height}}const ce=[{name:"Prowler",numOfA:0,price:{yellow:0,blue:1,orange:1,red:2,purple:1},score:0,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1},{name:"Wong",numOfA:0,price:{yellow:1,blue:1,orange:2,red:1,purple:0},score:0,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"Modok",numOfA:0,price:{yellow:0,blue:0,orange:2,red:2,purple:0},score:0,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1},{name:"Rocket",numOfA:0,price:{yellow:1,blue:0,orange:0,red:2,purple:0},score:0,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1},{name:"Abomination",numOfA:0,price:{yellow:0,blue:2,orange:1,red:1,purple:1},score:0,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Gorgon",numOfA:0,price:{yellow:2,blue:2,orange:0,red:0,purple:0},score:0,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Kraven",numOfA:0,price:{yellow:0,blue:3,orange:0,red:0,purple:0},score:0,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Spider Woman",numOfA:1,price:{yellow:1,blue:1,orange:0,red:3,purple:0},score:0,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1},{name:"Spider Man 2099",numOfA:0,price:{yellow:2,blue:0,orange:0,red:1,purple:0},score:0,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Sand Man",numOfA:0,price:{yellow:0,blue:0,orange:4,red:0,purple:0},score:1,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"Crystal",numOfA:0,price:{yellow:0,blue:0,orange:2,red:0,purple:2},score:0,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"Winter Soldier",numOfA:1,price:{yellow:0,blue:2,orange:1,red:2,purple:0},score:0,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Rhino",numOfA:0,price:{yellow:1,blue:1,orange:1,red:0,purple:1},score:0,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Squirrel Girl",numOfA:1,price:{yellow:0,blue:0,orange:1,red:2,purple:2},score:0,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1},{name:"Task Master",numOfA:0,price:{yellow:4,blue:0,orange:0,red:0,purple:0},score:1,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Elektra",numOfA:0,price:{yellow:2,blue:0,orange:0,red:0,purple:2},score:0,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Vulture",numOfA:0,price:{yellow:0,blue:0,orange:0,red:4,purple:0},score:1,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1},{name:"Scarlet Spider",numOfA:0,price:{yellow:0,blue:1,orange:1,red:1,purple:2},score:0,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Spider Girl",numOfA:0,price:{yellow:1,blue:1,orange:1,red:0,purple:1},score:0,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Lockjaw",numOfA:0,price:{yellow:1,blue:1,orange:1,red:0,purple:1},score:0,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Lizard",numOfA:0,price:{yellow:0,blue:2,orange:0,red:0,purple:1},score:0,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Hawkeye",numOfA:1,price:{yellow:1,blue:2,orange:0,red:0,purple:2},score:0,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Mysterio",numOfA:0,price:{yellow:0,blue:0,orange:3,red:0,purple:0},score:0,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"Valkyrie",numOfA:1,price:{yellow:3,blue:0,orange:1,red:0,purple:1},score:0,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Kingpin",numOfA:0,price:{yellow:1,blue:0,orange:0,red:0,purple:2},score:0,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Yondu",numOfA:0,price:{yellow:0,blue:0,orange:0,red:0,purple:4},score:1,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Electro",numOfA:0,price:{yellow:0,blue:0,orange:2,red:1,purple:0},score:0,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"Bullseye",numOfA:0,price:{yellow:0,blue:1,orange:1,red:2,purple:1},score:0,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Grand Master",numOfA:0,price:{yellow:1,blue:1,orange:0,red:1,purple:1},score:0,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1},{name:"Spider Ham",numOfA:0,price:{yellow:1,blue:0,orange:0,red:0,purple:2},score:0,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Silver Sable",numOfA:0,price:{yellow:0,blue:0,orange:0,red:0,purple:3},score:0,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Wasp",numOfA:1,price:{yellow:2,blue:1,orange:2,red:0,purple:0},score:0,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Quake",numOfA:1,price:{yellow:0,blue:1,orange:3,red:0,purple:1},score:0,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"Triton",numOfA:0,price:{yellow:1,blue:1,orange:1,red:1,purple:0},score:0,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"America Chavez",numOfA:1,price:{yellow:1,blue:3,orange:0,red:1,purple:0},score:0,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Kate Bishop",numOfA:1,price:{yellow:0,blue:1,orange:0,red:1,purple:3},score:0,color:r.ORANGE,levelColor:i.GREEN,isSelected:!1},{name:"Moon Knight",numOfA:0,price:{yellow:3,blue:0,orange:0,red:0,purple:0},score:0,color:r.BLUE,levelColor:i.GREEN,isSelected:!1},{name:"Scorpion",numOfA:0,price:{yellow:0,blue:4,orange:0,red:0,purple:0},score:1,color:r.PURPLE,levelColor:i.GREEN,isSelected:!1},{name:"Ms. Marvel",numOfA:1,price:{yellow:2,blue:0,orange:2,red:1,purple:0},score:0,color:r.RED,levelColor:i.GREEN,isSelected:!1},{name:"Baron Zemo",numOfA:0,price:{yellow:0,blue:0,orange:0,red:3,purple:0},score:0,color:r.YELLOW,levelColor:i.GREEN,isSelected:!1}],ae=[{name:"Hela",numOfA:0,price:{yellow:0,blue:6,orange:0,red:0,purple:0},score:3,color:r.RED,levelColor:i.ORANGE,isSelected:!1},{name:"Cross Bones",numOfA:0,price:{yellow:4,blue:2,orange:1,red:0,purple:0},score:2,color:r.PURPLE,levelColor:i.ORANGE,isSelected:!1},{name:"Beta Ray Bill",numOfA:1,price:{yellow:0,blue:3,orange:2,red:3,purple:0},score:1,color:r.RED,levelColor:i.ORANGE,isSelected:!1},{name:"Maximus",numOfA:0,price:{yellow:0,blue:2,orange:4,red:1,purple:0},score:2,color:r.YELLOW,levelColor:i.ORANGE,isSelected:!1},{name:"Quick Silver",numOfA:1,price:{yellow:2,blue:0,orange:0,red:3,purple:3},score:1,color:r.BLUE,levelColor:i.ORANGE,isSelected:!1},{name:"Red Skull",numOfA:0,price:{yellow:0,blue:0,orange:6,red:0,purple:0},score:3,color:r.YELLOW,levelColor:i.ORANGE,isSelected:!1},{name:"Star Lord",numOfA:0,price:{yellow:0,blue:1,orange:2,red:4,purple:0},score:2,color:r.ORANGE,levelColor:i.ORANGE,isSelected:!1},{name:"She Hulk",numOfA:1,price:{yellow:3,blue:0,orange:2,red:0,purple:2},score:1,color:r.PURPLE,levelColor:i.ORANGE,isSelected:!1},{name:"Okoye",numOfA:1,price:{yellow:3,blue:2,orange:0,red:0,purple:3},score:1,color:r.PURPLE,levelColor:i.ORANGE,isSelected:!1},{name:"Karnak",numOfA:0,price:{yellow:3,blue:0,orange:5,red:0,purple:0},score:2,color:r.YELLOW,levelColor:i.ORANGE,isSelected:!1},{name:"The Collector",numOfA:0,price:{yellow:0,blue:0,orange:5,red:0,purple:0},score:2,color:r.YELLOW,levelColor:i.ORANGE,isSelected:!1},{name:"Medusa",numOfA:0,price:{yellow:0,blue:5,orange:3,red:0,purple:0},score:2,color:r.RED,levelColor:i.ORANGE,isSelected:!1},{name:"Dare Devil",numOfA:0,price:{yellow:0,blue:0,orange:0,red:6,purple:0},score:3,color:r.ORANGE,levelColor:i.ORANGE,isSelected:!1},{name:"Miles Morales",numOfA:0,price:{yellow:0,blue:0,orange:0,red:0,purple:5},score:2,color:r.BLUE,levelColor:i.ORANGE,isSelected:!1},{name:"Black Cat",numOfA:0,price:{yellow:0,blue:0,orange:0,red:3,purple:5},score:2,color:r.BLUE,levelColor:i.ORANGE,isSelected:!1},{name:"Scarlet Witch",numOfA:1,price:{yellow:2,blue:3,orange:0,red:2,purple:0},score:1,color:r.RED,levelColor:i.ORANGE,isSelected:!1},{name:"Shuri",numOfA:1,price:{yellow:3,blue:2,orange:3,red:0,purple:0},score:1,color:r.YELLOW,levelColor:i.ORANGE,isSelected:!1},{name:"Nick Fury",numOfA:1,price:{yellow:0,blue:0,orange:3,red:3,purple:2},score:1,color:r.ORANGE,levelColor:i.ORANGE,isSelected:!1},{name:"Venom",numOfA:0,price:{yellow:0,blue:5,orange:0,red:0,purple:0},score:2,color:r.RED,levelColor:i.ORANGE,isSelected:!1},{name:"Jessica Jones",numOfA:0,price:{yellow:6,blue:0,orange:0,red:0,purple:0},score:3,color:r.PURPLE,levelColor:i.ORANGE,isSelected:!1},{name:"Nebula",numOfA:0,price:{yellow:0,blue:0,orange:0,red:0,purple:6},score:3,color:r.BLUE,levelColor:i.ORANGE,isSelected:!1},{name:"Ghost Spider",numOfA:0,price:{yellow:0,blue:2,orange:1,red:0,purple:4},score:2,color:r.BLUE,levelColor:i.ORANGE,isSelected:!1},{name:"Carnage",numOfA:0,price:{yellow:5,blue:0,orange:0,red:3,purple:0},score:2,color:r.PURPLE,levelColor:i.ORANGE,isSelected:!1},{name:"Ghost Rider",numOfA:0,price:{yellow:2,blue:4,orange:0,red:0,purple:1},score:2,color:r.RED,levelColor:i.ORANGE,isSelected:!1},{name:"War Machine",numOfA:1,price:{yellow:0,blue:2,orange:2,red:0,purple:3},score:1,color:r.BLUE,levelColor:i.ORANGE,isSelected:!1},{name:"Ronan",numOfA:0,price:{yellow:5,blue:0,orange:0,red:0,purple:0},score:2,color:r.PURPLE,levelColor:i.ORANGE,isSelected:!1},{name:"Punisher",numOfA:0,price:{yellow:0,blue:0,orange:0,red:5,purple:0},score:2,color:r.ORANGE,levelColor:i.ORANGE,isSelected:!1},{name:"Falcon",numOfA:1,price:{yellow:3,blue:0,orange:0,red:3,purple:2},score:1,color:r.ORANGE,levelColor:i.ORANGE,isSelected:!1},{name:"Groot",numOfA:0,price:{yellow:0,blue:0,orange:0,red:5,purple:3},score:2,color:r.ORANGE,levelColor:i.ORANGE,isSelected:!1},{name:"Maria Hill",numOfA:1,price:{yellow:0,blue:2,orange:3,red:0,purple:2},score:1,color:r.YELLOW,levelColor:i.ORANGE,isSelected:!1}];function Ae(){return{yellow:4,blue:4,orange:0,red:0,purple:0}}function ke(){return{yellow:0,blue:0,orange:0,red:4,purple:4}}function be(){return{yellow:4,blue:0,orange:4,red:0,purple:0}}function Le(){return{yellow:0,blue:0,orange:4,red:0,purple:4}}function Se(){return{yellow:0,blue:4,orange:0,red:4,purple:0}}function ve(){return{yellow:3,blue:0,orange:3,red:0,purple:3}}function Ge(){return{yellow:0,blue:3,orange:0,red:3,purple:3}}function Ne(){return{yellow:3,blue:3,orange:0,red:3,purple:0}}const Pe=[Ae(),ke(),be(),Le(),Se(),ve(),Ge(),Ne()];class Be{tokens;city;people;tmp;coveredCards;hasA;isWinner;constructor(){this.tokens=new P,this.city=[],this.people=[],this.tmp=new P,this.coveredCards=[],this.hasA=!1,this.isWinner=!1}addCard(e){this.people.push(e)}getCardsCount(e){return this.people.filter(l=>l.color===e).length}getYellowCardsCount(){return this.people.filter(e=>e.color===r.YELLOW).length}getBlueCardsCount(){return this.people.filter(e=>e.color===r.BLUE).length}getOrangeCardsCount(){return this.people.filter(e=>e.color===r.ORANGE).length}getRedCardsCount(){return this.people.filter(e=>e.color===r.RED).length}getPurpleCardsCount(){return this.people.filter(e=>e.color===r.PURPLE).length}showCity1(){return this.city.length>=1}showCity2(){return this.city.length>=2}showCity3(){return this.city.length>=3}showCity4(){return this.city.length>=4}showGreen(){return this.people.some(e=>e.levelColor===i.BLUE)}getScores(){const e=this.people.reduce((n,s)=>n+s.score,0),l=this.city.length*3,o=this.hasA?3:0;return e+l+o}getNumOfA(){return this.people.reduce((e,l)=>e+l.numOfA,0)}canWin(){return this.people.some(e=>e.color===r.YELLOW)&&this.people.some(e=>e.color===r.BLUE)&&this.people.some(e=>e.color===r.ORANGE)&&this.people.some(e=>e.color===r.RED)&&this.people.some(e=>e.color===r.PURPLE)&&this.showGreen()&&this.getScores()>=16}isClean(){return this.tokens.equals(new P)&&this.city.length===0&&this.people.length===0&&this.coveredCards.length===0}}class Ue{x;y;size;angle=0;targetAngle=0;cornerIndex=0;bounce=0;constructor(e,l,o=48){this.x=e,this.y=l,this.size=o}resetCornerIndex(){this.cornerIndex=0}pointTo(e,l){const o=e.length;l&&(this.cornerIndex=(this.cornerIndex+1)%o);const n=e[this.cornerIndex].x,s=e[this.cornerIndex].y;this.targetAngle=Math.atan2(s-this.y,n-this.x),this.bounce=1}draw(e){const l=this.x,o=this.y;this.angle=this.targetAngle,e.save(),e.translate(l,o),e.rotate(this.angle),e.font=`${this.size}px serif`,e.textAlign="center",e.textBaseline="middle",e.fillText("ğŸ‘‰",0,0),e.restore()}contains(e,l){const o=e-this.x,n=l-this.y,s=Math.cos(-this.angle),c=Math.sin(-this.angle),h=o*s-n*c,a=o*c+n*s,u=this.size*.5;return h>=-u&&h<=u&&a>=-u&&a<=u}}let te=0;function xe(t){te=t}let A=2;function We(t){A=t}let w=[];function Te(t){w=t}let N=new P;function Ye(t){N=t}let b=null;function F(t){b=t}let de=[];function Ie(t){de=t}let he=[];function Me(t){he=t}let ue=[];function De(t){ue=t}let M=[];function He(t){M=t}class fe{city;width;height;x;y;constructor(e,l,o,n,s){this.city=e,this.x=l,this.y=o,this.width=n,this.height=s}draw(e){if(this.city===null)return;e.fillStyle="#fff",e.fillRect(this.x,this.y,this.width,this.height),e.strokeStyle="black",e.strokeRect(this.x,this.y,this.width,this.height);const l=this.width/3,o=this.height/3,n=o/3,s=Object.entries(this.city).filter(([a,u])=>u>0).slice(0,3),c=this.y+n,h=c+o+n;s.forEach(([a,u],p)=>{let O=0,y=0;if(p===0)O=this.x+this.width/2-l/2,y=c;else if(p===1&&s.length===2)O=this.x+this.width/2-l/2,y=h;else{const L=p===1?n:n*2+l;O=this.x+L,y=h}e.fillStyle=ee[a],e.fillRect(O,y,l,o),e.strokeStyle="black",e.strokeRect(O,y,l,o),e.fillStyle="black",e.font=`${o-4}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(String(u),O+l/2,y+o/2+o*.05)})}contains(e,l){return e>=this.x&&e<=this.x+this.width&&l>=this.y&&l<=this.y+this.height}}class x{img;path;width;height;x;y;constructor(e,l,o,n,s,c){this.path=e,this.x=l,this.y=o,this.width=n,this.height=s,e&&(this.img=new Image,this.img.onload=c,this.img.src=e)}draw(e){if(!this.img||!this.img.complete)return;const l=Math.min(this.width/this.img.width,this.height/this.img.height),o=this.img.width*l,n=this.img.height*l,s=this.x+(this.width-o)/2,c=this.y+(this.height-n)/2;e.drawImage(this.img,s,c,o,n)}}class G{text;color;x;y;r;width;height;isRect;show;constructor(e,l,o,n,s,c,h,a,u=!0){this.text=e,this.color=l,this.x=o,this.y=n,this.r=s,this.width=c,this.height=h,this.isRect=a,this.show=u}draw(e){let l=0,o=0,n=0;e.fillStyle=this.show?this.color:I,e.strokeStyle=this.show?"black":I,this.isRect?(e.fillRect(this.x,this.y,this.width,this.height),e.strokeRect(this.x,this.y,this.width,this.height),l=this.height,o=this.width/2,n=this.height/2):(e.beginPath(),e.arc(this.x+this.r,this.y+this.r,this.r,0,Math.PI*2),e.fill(),e.stroke(),l=this.r*2,o=this.r,n=this.r),this.show&&(e.fillStyle="black",e.font=`${l-4}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,this.x+o,this.y+n+n*2*.05))}contains(e,l){const o=this.isRect?this.width:this.r*2,n=this.isRect?this.height:this.r*2;return e>=this.x&&e<=this.x+o&&l>=this.y&&l<=this.y+n}}class pe{text;width;height;x;y;constructor(e,l,o,n,s){this.text=e,this.x=l,this.y=o,this.width=n,this.height=s}draw(e){let l=this.height/2;e.fillStyle="black",e.font=`${l}px Arial`,e.textAlign="start",e.textBaseline="middle",e.fillText(this.text,this.x,this.y+l+l*2*.05)}contains(e,l){return e>=this.x&&e<=this.x+this.width&&l>=this.y&&l<=this.y+this.height}}const Q=[{id:"action_reset",icon:"ğŸ”„",title:"Reset",action:()=>{V()}},{id:"action_add_player",icon:"ğŸ‘«",title:"Add Player",action:()=>{We(A===2?3:A===3?4:2),V()}},{id:"action_manual",icon:"ğŸ“–",title:"Manual",action:()=>{const t=["./res/manual1.png","./res/manual2.png","./res/manual3.png","./res/manual4.png"],e=window.open("","_blank");if(e){const l=e.document.head,o=e.document.createElement("title");o.textContent="Manual",l.appendChild(o);const n=e.document.createElement("link");n.rel="icon",n.href="./res/favicon.png",n.type="image/png",l.appendChild(n);const s=e.document.createElement("style");s.textContent=`
                body {
                    margin: 0;
                    padding: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    background: #f0f0f0;
                }
                img {
                    max-width: 80%;
                    margin-bottom: 20px;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                    border-radius: 8px;
                }
            `,l.appendChild(s);const c=e.document.body;t.forEach(h=>{const a=e.document.createElement("img");a.src=h,c.appendChild(a)})}}},{id:"action_show_people",icon:"âœ‹",title:"show people",action:()=>{Ke()}}];function _(t){const e=[...t];for(let l=e.length-1;l>0;l--){const o=Math.floor(Math.random()*(l+1));[e[l],e[o]]=[e[o],e[l]]}return e}function je(){return Ie(_(se)),Me(_(ae)),De(_(ce)),[{backStack:de,closeCard:new J(null,i.BLUE,0,0,0,0,0),openCards:[],color:i.BLUE,y:0},{backStack:he,closeCard:new J(null,i.ORANGE,0,0,0,0,0),openCards:[],color:i.ORANGE,y:0},{backStack:ue,closeCard:new J(null,i.GREEN,0,0,0,0,0),openCards:[],color:i.GREEN,y:0}]}function Fe(){He(_(Pe).slice(0,A))}function _e(){const e=7-(A===2?3:A===3?2:0);Ye(new P({[d.YELLOW]:e,[d.BLUE]:e,[d.ORANGE]:e,[d.RED]:e,[d.PURPLE]:e,[d.GRAY]:5}))}function ze(){return Te(Array.from({length:A},()=>new Be)),Array.from({length:A},()=>({people:[],tokens:[],green:new G("G","#0f0",0,0,0,0,0,!1,!1),tmpTokens:[],scores:new pe("",0,0,0,0),cities:[],a:new x("",0,0,0,0,null),btnIn:new G("IN","#f0f",0,0,0,0,0,!0,!1),btnOut:new G("OUT","#f0f",0,0,0,0,0,!0,!1),showFirst:new x("",0,0,0,0,null),showWinner:new x("",0,0,0,0,null),coveredCards:[]}))}function $e(t,e){qe(t,e),Je(t,e),Qe(t,e),Ze(t,e),Ve(t,e),tt(t,e),lt(t,e),ne()}function S(){F(null),se.forEach(t=>t.isSelected=!1),ae.forEach(t=>t.isSelected=!1),ce.forEach(t=>t.isSelected=!1),w.forEach(t=>{t.coveredCards.forEach(e=>e.isSelected=!1)})}function Xe(t){const e=g.cornerIndex,l=w[e].tmp.tokens;if(l[d.GRAY]!==0)return!1;if(t===d.GRAY)return Object.entries(l).filter(([a])=>a!==t.toString()).reduce((a,[,u])=>a+u,0)==0&&w[e].coveredCards.length<3;const o=Object.entries(l).filter(([c])=>c!==t.toString()&&t!==d.GRAY.toString());if(o.some(([,c])=>c===2))return!1;const s=o.reduce((c,[,h])=>c+h,0);return l[t]===0?s<=2:l[t]===1?s===0&&N.tokens[t]>=3:!1}function Ke(){const t=window.open("show_people.html","hand");setTimeout(()=>{t?.postMessage({type:"HAND_UPDATE",players:w},"*")},300)}function qe(t,e){Q.forEach(l=>{l.x<=t&&t<=l.x+l.width&&l.y<=e&&e<=l.y+l.height&&l.action()})}function Je(t,e){W.forEach(l=>{if(l.contains(t,e)){const o=l.color;N.tokens[o]>0&&(Xe(o)?(N.tokens[o]--,l.value=N.tokens[o],w[g.cornerIndex].tmp.tokens[o]++):(q(),S()))}})}function Qe(t,e){T.forEach(l=>{const o=l.closeCard,n=o.contains(t,e);n&&o.card!==null&&(S(),o.card.isSelected=n,F(o.card)),l.openCards.forEach(s=>{s.contains(t,e)&&s.card!==null&&(S(),s.card.isSelected=!0,F(s.card))})}),Y.forEach((l,o)=>{o===g.cornerIndex&&l.coveredCards.forEach(n=>{n.contains(t,e)&&n.card!==null&&(S(),n.card.isSelected=!0,F(n.card))})})}function D(){const t=Ce();g.pointTo(t,!0)}function Ee(){let t=!0;w.forEach(e=>{e.isClean()||(t=!1)}),t&&xe(g.cornerIndex)}function Ze(t,e){Y.forEach((l,o)=>{l.btnIn.contains(t,e)?ct(o):l.btnOut.contains(t,e)&&at(o)})}function Ve(t,e){K.forEach((l,o)=>{if(l.contains(t,e))for(let n=0;n<=A;n++)we(n,o,!0)})}function et(t){const e=w[g.cornerIndex];e.tokens.tokens[t]--,e.tmp.tokens[t]++}function tt(t,e){Y.forEach(l=>{l.tokens.forEach(o=>{o.contains(t,e)&&et(o.color)})})}function lt(t,e){g.contains(t,e)&&(D(),Ee())}function le(){const t=w[g.cornerIndex],e=t.tmp.tokens,l=t.tokens.tokens;for(const o of Object.values(d))l[o]+=e[o];t.tmp=new P}function q(){const t=w[g.cornerIndex],e=t.tmp.tokens,l=N.tokens;for(const o of Object.values(d))l[o]+=e[o];t.tmp=new P}function rt(){confirm("é€€éŒ¯è«‹æŒ‰ã€Œç¢ºå®šã€æ”¶å›ï¼›ä¸èƒ½ç›´æ¥æ‹¿ï¼è«‹æŒ‰ã€Œå–æ¶ˆã€é‚„éŠ€è¡Œ")?le():(q(),S())}function ot(){confirm("ç¢ºå®šä¸æ‹¿ç°è‰²ï¼Ÿ")&&w[g.cornerIndex].coveredCards.length<3&&re()}function nt(){confirm("ä¸èƒ½è²·ï¼Œæ˜¯å¦æ”¶å…¥è“‹ç‰Œä¸­ï¼Ÿ")&&w[g.cornerIndex].coveredCards.length<3&&re()}function ge(){T.forEach(t=>{let e=t.closeCard.card;e!==null&&e==b&&(e=t.backStack.shift()??null),t.openCards.forEach(l=>{if(l.card!==null&&l.card==b){const o=t.backStack.shift()??null;l.card=o}})})}function re(){const t=g.cornerIndex,e=w[t];b!==null&&e.coveredCards.push(b),le(),ge(),S();const l=e.showGreen()?1:0;Object.entries(e.tokens.tokens).reduce((n,[,s])=>n+s,0)+l<=10&&(X(t),D())}function st(t,e,l,o,n){if(b===null)return;const s=t+e+l+o+n,c=b,h=w[g.cornerIndex],a=h.tokens.tokens,u=Math.max(c.price[r.YELLOW]-h.getYellowCardsCount(),0),p=Math.max(c.price[r.BLUE]-h.getBlueCardsCount(),0),O=Math.max(c.price[r.ORANGE]-h.getOrangeCardsCount(),0),y=Math.max(c.price[r.RED]-h.getRedCardsCount(),0),L=Math.max(c.price[r.PURPLE]-h.getPurpleCardsCount(),0);a[d.YELLOW]-=u,a[d.YELLOW]=Math.max(a[d.YELLOW],0),a[d.BLUE]-=p,a[d.BLUE]=Math.max(a[d.BLUE],0),a[d.ORANGE]-=O,a[d.ORANGE]=Math.max(a[d.ORANGE],0),a[d.RED]-=y,a[d.RED]=Math.max(a[d.RED],0),a[d.PURPLE]-=L,a[d.PURPLE]=Math.max(a[d.PURPLE],0),a[d.GRAY]-=s;const k=N.tokens;k[d.YELLOW]+=u-t,k[d.BLUE]+=p-e,k[d.ORANGE]+=O-l,k[d.RED]+=y-o,k[d.PURPLE]+=L-n,k[d.GRAY]+=s}function me(){const t=w.find(o=>o.hasA),e=w.filter(o=>o.getNumOfA()>=3).sort((o,n)=>n.getNumOfA()-o.getNumOfA());if(e.length===0)return;const l=e[0];if(!t){l.hasA=!0;return}l.getNumOfA()>t.getNumOfA()&&(t.hasA=!1,l.hasA=!0)}function it(){const t=g.cornerIndex,e=w[t],l=[];M.forEach((n,s)=>{n!==null&&n[r.YELLOW]<=e.getYellowCardsCount()&&n[r.BLUE]<=e.getBlueCardsCount()&&n[r.ORANGE]<=e.getOrangeCardsCount()&&n[r.RED]<=e.getRedCardsCount()&&n[r.PURPLE]<=e.getPurpleCardsCount()&&l.push(s)});const o=l.length;return o===0?(me(),!0):o===1?(we(t,l[0]),!0):(alert("è«‹é¸ä¸€å¼µåŸå¸‚å¡"),!1)}function we(t,e,l=!1){if(g.cornerIndex!==t)return;const n=w[t];let s=M[e];s!==null&&s[r.YELLOW]<=n.getYellowCardsCount()&&s[r.BLUE]<=n.getBlueCardsCount()&&s[r.ORANGE]<=n.getOrangeCardsCount()&&s[r.RED]<=n.getRedCardsCount()&&s[r.PURPLE]<=n.getPurpleCardsCount()&&(n.city.push(s),M[e]=null),me(),l&&(X(t),D())}function ct(t){if(g.cornerIndex!==t)return;const e=w[t],l=e.tokens.tokens,o=e.tmp.tokens;if(o[d.GRAY]!==0)if(b===null||e.coveredCards.some(c=>c.name===b?.name)){rt();return}else{re();return}const s=Object.entries(o).filter(([c])=>c!==d.GRAY.toString()).reduce((c,[,h])=>c+h,0);if(b==null)if(s>0){le();const c=e.showGreen()?1:0;Object.entries(l).reduce((a,[,u])=>a+u,0)+c<=10&&(X(t),D())}else return;else if(s>0)q(),S();else{if(e.coveredCards.length<3&&T.some(C=>C.closeCard.card==b)){ot();return}const c=b,h=e.getYellowCardsCount()+l[d.YELLOW],a=e.getBlueCardsCount()+l[d.BLUE],u=e.getOrangeCardsCount()+l[d.ORANGE],p=e.getRedCardsCount()+l[d.RED],O=e.getPurpleCardsCount()+l[d.PURPLE],y=c.price[r.YELLOW]>h?c.price[r.YELLOW]-h:0,L=c.price[r.BLUE]>a?c.price[r.BLUE]-a:0,k=c.price[r.ORANGE]>u?c.price[r.ORANGE]-u:0,H=c.price[r.RED]>p?c.price[r.RED]-p:0,j=c.price[r.PURPLE]>O?c.price[r.PURPLE]-O:0,B=y+L+k+H+j;if(l[d.GRAY]>=B){if(st(y,L,k,H,j),e.addCard(c),e.coveredCards.some(R=>R.name===c.name)){const R=e.coveredCards.findIndex(v=>v.name===c.name);R!==-1&&e.coveredCards.splice(R,1)}else ge();it()&&(X(t),D())}else{nt();return}S()}}function at(t){g.cornerIndex===t&&(q(),S())}function X(t){if(t!==(A-1+te)%A)return;if(Array.from({length:A},(c,h)=>w[h].canWin())[t]){w[t].isWinner=!0;return}const l=w.filter(c=>c.canWin());if(l.length===0)return;const o=l.sort((c,h)=>h.getScores()-c.getScores()),n=o.filter(c=>c.getScores()===o[0].getScores());if(n.length===1){n[0].isWinner=!0;return}console.log("===Blaze=== 5");const s=n.find(c=>c.hasA);if(s)s.isWinner=!0;else{const c=n.sort((a,u)=>a.people.length-u.people.length);c.filter(a=>a.people.length===c[0].people.length).forEach(a=>a.isWinner=!0)}}let T=[],K=[],W=[],Y=[];const g=new Ue(200,200,48),m=document.getElementById("canvas"),E=m.getContext("2d"),f=10,dt=1/20,ht=1/40,ut=1/50,ft=1/40,pt=1/40;let Z=0,oe=0,ye=0;function Et(){const t=m.width*dt,e=t*2,l=t+f,o=m.width/2-t*1.5-f*1;oe=o+t*4+f*3;const n=(m.height-U)/2-e*1.5-f;Z=n,T.forEach((s,c)=>{if(s.y=n+c*(e+f),s.openCards.length===0)for(let a=0;a<4;a++){const u=s.backStack.shift()??null;s.openCards.push(new ie(u,s.color,o+a*l,s.y,t,e))}else s.openCards.forEach((a,u)=>{a.x=o+u*l,a.y=s.y,a.width=t,a.height=e});const h=s.backStack.length;s.closeCard.card=h>0?s.backStack[0]:null,s.closeCard.cardLeft=h,s.closeCard.x=o-l,s.closeCard.y=s.y,s.closeCard.width=t,s.closeCard.height=e})}function gt(){const t=m.width*ht,e=t,l=t+f,o=oe+f;ye=Z+2*e+f,K=[],M.forEach((n,s)=>{const c=s%2,h=s<2?0:1;K.push(new fe(n,o+c*l,Z+h*(e+f),t,e))})}function mt(){const t=m.width*ft/2,e=t*2+f,l=oe+f,o=ye+f;W=[],Object.values(d).forEach((n,s)=>{const c=s%2,h=Math.floor(s/2);W.push(new $(N.tokens[n],n,l+c*e,o+h*e,t))})}function wt(){const t=m.width*ut,e=t*6+f*4,l=.8,o=f+(t+f)*8+(t*l+f)*3,n=4;Y.forEach((s,c)=>{const h=w[c],a=c<2?f:m.width-f-o;let u=a+t,p=c===0||c===3?m.height-f-t:U+f+e;const O=c===0||c===3?p-e*2:p+t;let y=h.isWinner?"./res/thanos.webp":"";const L=Math.min(o,e);s.showWinner=new x(y,a,O,L,L,z),s.btnIn=new G("IN","#f0f",u,p,0,t*2,t,!0,!0),u+=t*2+f*2,s.btnOut=new G("OUT","#f0f",u,p,0,t*2,t,!0,!0),u+=t*2+f*2,y=te===c?"./res/first.png":"",s.showFirst=new x(y,u,p,t*2,t,z),p-=t+f,u=a,s.scores=new pe(`åˆ†ï¼š${h.getScores()} Aï¼š${h.getNumOfA()}`,u,p,t*4,t),u+=s.scores.width+f,h.city.forEach((C,R)=>{const v=new fe(C,u+R*(t+f),p,t,t);s.cities.push(v)});const k=h.city.length;let H=Array.from({length:n-k},(C,R)=>new G("",I,u+(k+R)*(t+f),p,0,t,t,!0,!1));s.cities.push(...H),u+=n*(t+f),y=h.hasA?"./res/marvel_a.png":"",s.a=new x(y,u,p,t,t,z),p-=t+f,u=a,s.tokens=[],Object.values(d).forEach(C=>{s.tokens.push(new $(h.tokens.tokens[C],C,u,p,t/2)),u+=t+f});const j=h.showGreen();s.green=new G("G","#0F0",u,p,t/2,0,0,!1,j),u+=(t+f)*2,s.tmpTokens=[],Object.values(d).forEach(C=>{const R=h.tmp.tokens[C],v=s.tmpTokens.length;R>0&&s.tmpTokens.push(new $(R,C,u+v*(t*.8+f),p,t*l/2))}),u=a,p-=t+f,s.people=[],Object.values(r).forEach((C,R)=>{const v=h.getCardsCount(C);s.people.push(new G(String(v),ee[C],u+R*(t+f),p,0,t,t,!0,v>0))});const B=t*1.5;p-=B*2+f,s.coveredCards=[],h.coveredCards.forEach((C,R)=>{s.coveredCards.push(new ie(C,C.color,u+R*(B+f),p,B,B*2))})})}function yt(){const t=W[W.length-1];g.size=m.width*pt,g.x=t.x,g.y=t.y+t.r*2+f+g.size}const U=30;function Ct(){const t=m.width/Q.length;Q.forEach((e,l)=>{const o=l*t,n=0;e.x=o,e.y=n,e.width=t,e.height=U,E.fillStyle="#fff",E.fillRect(o+2,n,t-4,U),E.font="20px Arial",E.textAlign="center",E.textBaseline="middle",E.fillStyle="#000",E.fillText(e.icon,o+t/2-30,U/2),E.font="16px Arial",E.fillText(e.title,o+t/2+30,U/2)})}function Ot(){T.forEach(t=>{t.closeCard.draw(E),t.openCards.forEach(e=>e.draw(E))})}function Rt(){K.forEach(t=>t.draw(E))}function At(){W.forEach(t=>t.draw(E))}function z(){Y.forEach(t=>{t.people.forEach(e=>e.draw(E)),t.tokens.forEach(e=>e.draw(E)),t.green.draw(E),t.tmpTokens.forEach(e=>e.draw(E)),t.scores.draw(E),t.cities.forEach(e=>e.draw(E)),t.a.draw(E),t.btnIn.draw(E),t.btnOut.draw(E),t.showFirst.draw(E),t.coveredCards.forEach(e=>e.draw(E)),t.showWinner.draw(E)})}function Ce(){return[{x:0,y:m.height},{x:0,y:0},{x:m.width,y:0},{x:m.width,y:m.height}].slice(0,A)}function kt(){const t=Ce();g.pointTo(t,!1),g.draw(E)}function ne(){E.clearRect(0,0,m.width,m.height),Ct(),Et(),Ot(),gt(),Rt(),mt(),At(),wt(),z(),yt(),kt()}function V(){m.width=window.innerWidth,m.height=window.innerHeight,T=je(),Fe(),_e(),Y=ze(),g.resetCornerIndex(),Ee(),ne()}function bt(){m.width=window.innerWidth,m.height=window.innerHeight,ne()}m.addEventListener("click",t=>{const e=m.getBoundingClientRect(),l=t.clientX-e.left,o=t.clientY-e.top;$e(l,o)});window.addEventListener("resize",bt);V();
